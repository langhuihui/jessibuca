
# 简介
jessibuca pro 是在开源版本的基础上额外支持的深入业务解决方案的。解决了一些痛点，比如H265的硬解码，SIMD软解码加速。
-
-
-
-
-
-
-
-
-
<Rice/>
## 开源版与PRO 差异性

|                                             | 开源版   | Pro |
|---------------------------------------------|-------| --- |
| H.264 WASM视频(720P)                          | 支持    | 支持 |
| H.265 WASM视频(720P)                          | 支持    | 支持 |
| H.264 WASM SIMD视频(1080P及以上)                 | 不支持 | 支持 |
| H.265 WASM SIMD视频(1080P及以上)                 | 不支持   | 支持 |
| WASM(SIMD)支持webgl canvas渲染                  | 支持   | 支持 |
| WASM(SIMD)支持 video 渲染                       | 不支持   | 支持 |
| WASM智能不花屏丢帧，长时间播放绝不累积延迟                     | 支持   | 支持 |
| WASM 离屏渲染                                   | 支持    | 支持 |
| H.264 MSE解码视频                               | 支持    | 支持 |
| H.265 MSE解码视频                               | 不支持   | 支持 |
| MSE支持webgl canvas渲染                         | 不支持   | 支持 |
| MSE支持video渲染                                | 支持   | 支持 |
| MSE智能不花屏丢帧，长时间播放绝不累积延迟                      | 不支持   | 支持 |
| MSE解码失败自动切换到WASM解码                          | 支持    | 支持 |
| H.264 WCS解码视频                               | 支持    | 支持 |
| H.265 WCS解码视频                               | 不支持   | 支持 |
| WCS支持webgl canvas渲染                         | 支持   | 支持 |
| WCS支持video渲染                                | 不支持   | 支持 |
| WCS智能不花屏丢帧，长时间播放绝不累积延迟                      | 不支持   | 支持 |
| WCS解码失败自动切换到WASM解码                          | 支持    | 支持 |
| WCS 离屏渲染                                    | 支持    | 支持 |
| AAC音频                                       | 支持    | 支持 |
| PCMA(g711a)、PCMU(g711u)音频                   | 支持    | 支持 |
| 音频worlet引擎（https）                           | 不支持    | 支持 |
| 音频script引擎 (默认)                             | 支持    | 支持 |
| 音频active引擎（兼容安卓移动端）                         | 不支持    | 支持 |
| 支持单视频播放                                     | 支持    | 支持 |
| 支持单音频播放                                     | 不支持    | 支持 |
| 设置播放缓冲区时长                                   | 支持    | 支持 |
| 创建多个播放实例                                    | 支持    | 支持 |
| http-flv协议流                                 | 支持    | 支持 |
| websocket-flv协议流                            | 支持    | 支持 |
| websocket-raw(M7S)协议流                       | 支持    | 支持 |
| Hls协议流(H264)                                | 不支持    | 支持 |
| WebTransport协议流                             | 不支持    | 支持 |
| WebRTC协议流                                   | 不支持    | 支持 |
| 加密流（M7S）                                    | 不支持    | 支持 |
| 显示模式（填充，等比，等比缩放）                            | 支持    | 支持 |
| 画面镜像（水平，垂直）                                 | 不支持    | 支持 |
| 画面旋转（0，90，180，270）                          | 支持    | 支持 |
| 底部UI                                        | 支持    | 支持 |
| 底部UI（H5）                                    | 支持    | 支持 |
| 底部UI支持自动隐藏                                  | 支持    | 支持 |
| 底部UI按钮支持自定义方法                               | 不支持    | 支持 |
| 底部UI按钮支持添加自定义按钮                             | 不支持    | 支持 |
| 键盘快捷键                                       | 支持    | 支持 |
| 支持隐藏默认loading效果                             | 不支持    | 支持 |
| 配置右键菜单以及事件                                  | 不支持    | 支持 |
| 性能面板<br/>可以查看实时数据（延迟，时间戳，基本信息，解码器信息等）       | 不支持    | 支持 |
| WebWorker                                   | 支持    | 支持 |
| 视频录制（webm格式的webm、mp4文件）                     | 支持    | 支持 |
| 视频录制（MPEG-4格式的mp4文件）                        | 不支持    | 支持 |
| 支持网络延迟检测，设置超过延迟重新拉流播放                       | 不支持    | 支持 |
| 支持设置播放加载超时，设置间隔时间，自动重试次数                    | 支持    | 支持 |
| 支持设置播放过程流断检测，设置间隔时间，自动重试次数                  | 支持    | 支持 |
| work线程中发起Http-Flv、WS等请求                     | 不支持    | 支持 |
| 语音通讯（采集麦克风数据）                               | 不支持    | 支持 |
| 语音通讯（设置编码格式PCM/G711A/G711U/Opus）            | 不支持    | 支持 |
| 语音通讯（设置采样率16000Hz或8000Hz）                   | 不支持    | 支持 |
| 语音通讯（设置采样位数3位或16位或8位）                       | 不支持    | 支持 |
| 语音通讯（设置声道单声道或双声道）                           | 不支持    | 支持 |
| 语音通讯（设置rtp包封装）                              | 不支持    | 支持 |
| TF卡（录像流）流播放                                 | 不支持    | 支持 |
| TF卡（录像流）流播放，（2/4/8/16/32/64）倍率播放            | 不支持    | 支持 |
| TF卡（录像流）流播放，关键帧解码播放                         | 不支持    | 支持 |
| TF卡（录像流）流播放，配套UI 24小时进度条                    | 不支持    | 支持 |
| TF卡（录像流）流播放，配套UI 倍率（2/4/8/16/32/64）选择       | 不支持    | 支持 |
| TF卡（录像流）流播放，直接解码前缓存数据                       | 不支持    | 支持 |
| UI控件PTZ（云台）操作盘<br/>(支持配置点击事件和鼠标按下和松开事件两种交互) | 不支持    | 支持 |
| UI控件流分辨率配置(自定义)和展示                          | 不支持    | 支持 |
| 电子放大                                        | 不支持    | 支持 |
| 播放器自定义水印                                    | 不支持    | 支持 |
| 截图加自定义水印                                    | 不支持    | 支持 |
| 全屏水印                                        | 不支持    | 支持 |
| AI人脸识别                                      | 不支持    | 支持 |
| AI物品识别（人、车辆等）                               | 不支持    | 支持 |
| 支持通过ws接口获取服务器端画面坐标系（画框子）<br/>实时渲染在播放器上，     | 不支持    | 支持 |
| 播放异常(崩溃)日志收集（方便发送给服务器端）                     | 不支持    | 支持 |
| 播放过程中超时，重新加载的时候，显示最后一帧画面                    | 不支持    | 支持 |
| N*N路UI多屏播放(最多4*4)                           | 不支持    | 支持 |
| 提供业务解决方案文档                                  | 不支持    | 支持 |
| 支持定制化服务开发                                   | 不支持    | 支持 |



## Pro 体验版本和 Pro正式版本区别

1. 体验版的解码时间限制是在一个小时，超过一个小时wasm 会暂停解码。
2. 体验版会强制在右上角有 jessibuca-pro 水印。
3. 体验版会强制全屏水印（JessibucaPro 体验）。

包含的文件有：

- jessibuca-pro-demo.js(script标签引入)
- decoder-pro.js (初始化参数decoder参数配置)
- decoder-pro.wasm(胶水文件)
- decoder-pro-simd.js (初始化参数decoder参数配置)
- decoder-pro-simd.wasm(胶水文件)


## 直播协议支持

| 协议                          | 支持情况 |
|:----------------------------| :--- |
| ws-raw(M7S私有协议)             | 支持 |
| ws-flv                      | 支持 |
| http-flv                    | 支持 |
| HLS                         | 支持 |
| WebTransport(M7S服务器)   | 支持 |
| Webrtc (M7S服务器)        | 支持 |


> HLS协议目前只支持H264编码格式，其他协议都支持H264和H265编码格式。


## 视频编码格式支持

| 编码格式      | 支持情况 |
|:----------| :--- |
| H264（软解码） | 支持 |
| H265（软解码） | 支持 |
| H264（硬解码） | 支持 |
| H265（硬解码） | 支持 |

> H265硬解码需要对于浏览器有要求。


## 音频编码格式支持

| 编码格式  | 支持情况 |
|:------| :--- |
| G711A | 支持 |
| G711U | 支持 |
| AAC   | 支持 |



## 分辨率支持

支持任意分辨率（720P、1080P、2k、4k）

> 分辨力越高，对于解码要求越高，对于浏览器有要求，对于设备有要求。

## 浏览器支持

> 基础功能支持主流浏览器。

> 会存在部分功能只支持部分浏览器。

> MSE和WebCodecs硬解码H265需要Chrome 107及以上

| 浏览器 | 支持情况 |
| :--- | :--- |
| Chrome | 支持 |
| Firefox | 支持 |
| Edge | 支持 |
| Safari | 支持 |

> 默认指的都是较新版本的浏览器，如果是较老版本的浏览器，可能会有部分功能不支持。

### 对于hevc(265)支持情况

<img src="/public/hevc-support.png">

[caniuse详情](https://caniuse.com/?search=hevc)



### 对于Webassembly支持情况

<img src="/public/webassembly-support.png">

[caniuse详情](https://caniuse.com/?search=webassembly)


### PC端

根据推荐配置，优先使用mse硬解码，如果不支持mse，会降级到wasm simd解码，如果不支持wasm simd，会降级到wasm解码。


| 浏览器 | wasm | wasm simd | mse 解码H264| mse 解码H265 | webcodecs 解码H264 |webcodecs 解码H265 |
| :--- | :--- | :--- |:-----------| :--- |:-----------| :--- |
| Chrome | 支持 | 支持 | 支持         | 支持 | 支持         | 支持 |
| Firefox | 支持 | 支持 | 支持         | 不支持 | 不支持         |  不支持 |
| Edge | 支持 | 支持 | 支持         | 支持 | 支持         | 支持 |
| Safari | 支持 | 不支持 | 支持        | 支持 | 不支持         | 不支持 |

> mse 解码H265 需要window系统在10及以上，chrome的版本得108及以上才能够支持
>
> webcodecs 解码H265 需要https环境，同样需要window系统在10及以上，chrome的版本得107及以上才能够支持




### 移动端

#### 安卓

> 安卓的浏览器基本都支持mse，优先使用mse硬解码。

根据推荐配置，优先使用mse硬解码(h264+h265)，如果不支持mse，会降级到wasm simd解码，如果不支持wasm simd，会降级到wasm解码。

| 浏览器      | wasm | wasm simd | mse 解码H264| mse 解码H265 | webcodecs 解码H264 | webcodecs 解码H265|
|:---------|:-----|:----------|:-----------| :----------- |:-------------------| :--------------- |
| Chrome   | 支持   | 支持        | 支持         | 支持 | 支持         | 支持 |
| 微信内置     | 支持   | 支持        | 支持       | 支持 | 支持         | 支持 |



#### 苹果

> 苹果自带的浏览器不支持mse，所以只能使用wasm解码。


| 浏览器    | wasm | wasm simd | mse 解码H264| mse 解码H265 | webcodecs 解码H264 | webcodecs 解码H265|
|:-------| :--- | :--- |:-----------| :--- |:-----------| :--- |
| Safari | 支持 | 不支持 | 不支持        | 不支持 | 不支持         | 不支持 |
| Chrome | 支持 | 不支持 | 不支持         | 不支持 | 不支持         | 不支持 |
| 微信内置   | 支持 | 不支持 | 不支持         | 不支持 | 不支持         | 不支持 |


## 操作系统

> 基础功能支持主流操作系统。

> 会存在部分功能只支持部分操作系统。

| 操作系统 | 支持情况 |
| :--- |:-----|
| Windows | 支持   |
| Linux | 部分支持 |
| Mac | 支持   |
| Android | 支持   |
| iOS | 支持   |



## 电脑型号（硬件配置）以及码率
<img src="/public/configuration.png">


> 例如：6路 1080p的视频，所需的内存为：6 * 300 = 1800M，1800/1024 = 1.75G

> 例如：6路 720p的视频，所需的内存为：6 * 200 = 1200M，1200/1024 = 1.17G

> 对于硬解码，如果只是集成显卡的情况，对于1080P的H265视频，4路基本不卡（推荐，gpu的占比基本30%以下），5路，6路都是轻微（gpu的占比基本50%左右），7路卡顿增多（gpu的占比基本60%左右），8路，9路（gpu的占比基本60%-80%）就是整个画面一直在卡了。

> 所以如果想要上4路以上的多屏，就得上独立显卡了。
>

### 对于H265硬解码显卡的支持情况：

<img src="/public/hevc-1.png">


[硬件支持情况](https://github.com/StaZhu/enable-chromium-hevc-hardware-decoding/blob/main/README.zh_CN.md)

#### 独显
NVIDIA GTX950 及以上

AMD RX460 及以上

#### 集显
Intel HD4400, HD515 及以上

AMD Radeon R7, Vega M 及以上

Apple M1, M1 Pro, M1 Max, M1 Ultra 及以上


#### 详细支持列表
[Intel](https://bluesky-soft.com/en/dxvac/deviceInfo/decoder/intel.html)

[AMD](https://bluesky-soft.com/en/dxvac/deviceInfo/decoder/amd.html)

[NVIDIA](https://bluesky-soft.com/en/dxvac/deviceInfo/decoder/nvidia.html)

## 关于延迟

> 标准配置延迟能够基本控制在1s以内。

> 可以支持超低延迟300ms以内。








## 基础版本
- 支持解码H.264视频(Baseline, Main, High Profile全支持，支持解码B帧视频)
- 支持解码H.265视频（flv id == 12）
- 支持解码AAC音频(LC,HE,HEv2 Profile全支持)
- 支持解码PCMA音频以及PCMU音频格式
- 可设置播放缓冲区时长，可设置0缓冲极限低延迟（网络抖动会造成卡顿现象）
- 支持WASM智能不花屏丢帧，长时间播放绝不累积延迟。
- 可创建多个播放实例
- 程序精简，经CDN加速，GZIP压缩（实际下载500k），加载速度更快
- 同时支持http-flv和websocket-flv协议以及websocket-raw私有协议（裸数据，传输量更小，需要搭配Monibuca服务器）
  注：以http-flv请求时，存在跨域请求的问题，需要设置access-control-allow-origin, websocket-flv默认不存在此问题
- 支持HTTPS/WSS加密视频传输，保证视频内容传输安全
- 手机浏览器内打开视频不会变成全屏播放
- 手机浏览器内打开长时间不会息屏
- 支持解码8kHz PCM_ALAW, PCM_MULAW的G.711音频
- 支持填充，等比，等比缩放 3中视频缩放模式
- 支持0，90，180，270度画面旋转
- 自带底部UI,支持原子化配置是否显示(播放/暂停、音量调节、截屏、录制/暂停录制、全屏/取消全屏、流量显示)
- 自带底部UI适配H5移动端，并支持web端全屏(操作栏适配横屏)
- 自带底部UI支持设置成自动隐藏，只有鼠标聚焦到播放器内部才会显示，移除之后，会消失。
- 支持键盘快捷键
- 支持OffscreenCanvas，提升Webgl渲染性能
- 支持WebWorker多核解码，提升多画面播放性能
- 支持WebCodecs硬件解码API
- 支持WebCodecs硬件解码配置通过video标签渲染或者canvas标签渲染画面
- 支持MediaSourceExtensions 硬件解码
- 支持WebCodecs和MediaSourceExtensions硬解码失败的情况下自动切换到wasm软解码
- 支持同一个播放地址视频分辨率发生变化的时候视频不花屏(仅软解码)
- 支持同一个播放地址音频采样和编码发生改变的时候音频自动切换
- 支持视频录制(WebM、MP4格式)，(MP4格式支持在IOS VLC播放器显示时长播放，Android VLC播放器无法显示时长播放,PC VLC播放器可以播放)

## PRO 额外支持的
- 支持开源版几乎所有的方法和事件，支持无缝升级到PRO版本。
- wasm解码模式下默认work线程中发起Http-Flv、WS请求，减少主线程往worker线程传递数据，提升性能。
- 360浏览器可播放使用MSE加速解码H265。
- 最新edge可使用MSE加速解码H265。
- 最新chrome 107版本及以上支持使用Webcodecs硬件加速解码播放H265。
- 支持MSE硬解码智能不花屏丢帧，长时间播放绝不累积延迟。
- 支持Webcodecs硬解码智能不花屏丢帧，长时间播放绝不累积延迟。
- 支持检测网络延迟，并可以设置延迟达到一定时间段重新触发播放逻辑。
- 支持只播放直播流或者TF卡流中的单一视频或者单一音频数据。
- 支持语音通讯：支持设置采集PCM/G711A/G711U格式的数据、支持设置采样率16000Hz或8000Hz，支持设置采样精度32bits或者16bits或者8bits，支持设置单通道或双通道。
- 支持UI控件语音通讯交互按钮，提供事件回调，方便全屏模式下操作。
- 支持音视频流（TF卡流）的倍数播放，支持2/4/8/16/32/64倍数控制，支持设置多少倍之后只解码I帧播放。
- 支持UI控件音视频流（TF卡流）的底部24小时进度条，并支持精度控制，提供事件回调，方便全屏模式下操作。
- 支持TF卡流暂停(不断开连接，停止渲染，方便业务通过接口方式通知服务器不推流，不会触发页面渲染超时)和恢复播放。
- 支持UI控件PTZ操作盘，提供事件回调，方便全屏模式下操作。
- 支持UI控件直接关闭播放器，并有事件通知，方便在多屏模式下，对直接对某个播放页面进行关闭操作。
- 支持UI控件流分辨率配置和展示，提供事件回调，方便在全屏模型下操作。
- 支持UI控件电子放大，提供事件回调，方便在全屏模型下操作。
- 支持UI控件在TF卡流配置不断流暂停，并且提供事件监听，方便上层去配合服务器端停止发送流，实现不断流的暂停功能。
- 支持UI控件切换显示模式(拉伸、缩放、正常)
- 支持HLS H264格式协议。
- 支持镜像旋转(水平+垂直)。
- 支持crypto解密播放。
- 支持webrtc标准流播放。
- 支持WebTransport协议播放。
- 支持H264裸流播放。
- 支持H265裸流播放。
- 支持MSE硬解码之后通过canvas渲染播放。
- 支持WASM解码之后通过video渲染播放。
- 支持视频录制MP4(MPEG-4)格式,支持H264、H265格式，录制的视频支持seek，快进，显示总时长等（仅支持视频录制，暂不支持音频）。
- 支持播放器自定义水印,支持播放器播放过程中，显示水印，例如公司名称，公司logo等。
- 支持截图加自定义水印,支持调用截图接口的时候，添加自定义水印，例如公司名称，公司logo等。
- 支持SIMD软解码加速(使用Chrome/Edge 91, Firefox89及之后正式提供的SIMD指令集加速解码, 在1080P以上分辨率带来100%-300%的性能提升)。
- 支持定制化服务开发。

## PRO AI

### 人脸识别

主要是利用openvc的人脸识别功能，识别出人脸后，打上框子。

>
> 需要单独购买人脸识别的授权，授权后才能使用。

### 物品识别

主要是给识别到的物品打上tag，支持人、车辆、物品等。

>
> 需要单独购买人脸识别的授权，授权后才能使用。



## wasm解码模式下默认work线程中发起Http-Flv、WS请求，减少主线程往worker线程传递数据，提升性能
wasm解码模式下默认work线程中发起Http-Flv、WS请求，减少主线程往worker线程传递数据，提升性能


## Windows系统下,360浏览器可播放使用MSE加速解码H265。
Windows系统下,360浏览器可播放使用MSE加速解码H265。
## Windows系统下,win10商店购买hevc解码器后最新edge可硬件加速解码播放H265。
Windows系统下,win10商店购买hevc解码器后最新edge可硬件加速解码播放H265。

### Chromium 内核的 Edge 在 Windows 系统下，额外支持了硬解 HEVC 视频，但必须满足如下条件：

- 操作系统版本必须为 Windows 10 1709（16299.0）及以后版本。
- 安装付费的 HEVC 视频扩展或免费的来自设备制造商的 HEVC 视频扩展且版本号必须大于等于 1.0.50361.0（由于一个存在了一年半以上的 Bug，老版本存在抖动的 Bug，Issue：https://techcommunity.microsoft.com/t5/discussions/hevc-video-decoding-broken-with-b-frames/td-p/2077247/page/4）。
- 版本号必须大于等于 Edge 99 。

在安装插件后，进入 edge://gpu 页面，可以查看 Edge 对于 HEVC 硬解支持的 Profile：

### 指标：

- 分辨率最高支持 8192px * 8192px。
- 支持 HEVC Main / Main10 / Main Still Picture Profile。
### 优势：

- 在显卡支持的情况，性能是最好的。
- HTMLVideoElement、MSE 等原生 API 的直接支持。
### 劣势：

- 不支持 Windows 8 和老版本 Windows 10。
- 需要手动装插件。
- HDR 支持不够好。

## macOS系统下，Safari浏览器可播放使用MSE加速解码H265。

由于 Apple 是 HEVC 标准的主要推动者，因此早在 17 年的 Safari 11 即完成了 HEVC 视频硬解的支持，无需安装任何插件开箱即用。

### 指标：

- 分辨率最高支持 8192px * 8192px。
- 支持 HEVC Main / Main10 Profile，M1+ 机型支持部分 HEVC Rext Profile。
### 优势：

- 在显卡支持的情况，性能是最好的。
- HTMLVideoElement、MSE 等原生 API 的直接支持。
- 开箱即用，无需装插件。
- HDR 支持最好（比如：杜比视界 Profile5，杜比全景声）。
### 劣势：

- 生态不足，缺乏大量 Chromium 内核下“可用、好用的”插件。
- Safari 俗称“下一个 IE”，其浏览器 API 兼容性与实现，相比 Chromium 仍有差距。
- 部分 HEVC 视频莫名其妙无法播放，哪怕视频本身没问题。

## 支持webrtc标准流播放

遵循的协议是：https://datatracker.ietf.org/doc/html/draft-ietf-wish-whip-03

### 目前存在的弊端
目前不管是http-flv 或者 websocket-flv协议 以及websocket-raw私有协议 都存在了部分延迟。

### 解决了啥问题

webrtc 超低延迟

## 支持语音通讯

- 支持采集PCM/G711A/G711U格式的数据、
- 支持设置采样率为16000Hz或8000Hz，
- 采样设置精度32bits或者16bits或者8bits，支持单通道或双通道

### 整体逻辑

1. 浏览器端采集麦克风数据
2. 将麦克风数据(rtp包)发送给服务端
3. 服务器端将麦克风数据(rtp包)转发给摄像头
4. 摄像头播放声音


## 支持音视频流（TF卡流）的倍数播放

- 支持TF卡流的倍数播放
- 支持自定义帧率(fps)
- 支持音频变速不变调
- 支持2/4/8/16/32/64倍数控制，支持设置多少倍之后只解码I帧播放。

## 支持音视频流（TF卡流）的底部24小时进度条，并支持精度控制

- 支持全屏模式下，可以查看进度条
- 支持全屏模式下，进度时间的点击交互

### 解决了啥问题

Audio Context的部分音频节点提供了playbackRate属性以实现倍速播放的功能，但是音频在倍速播放的同时，音频的音调（pitch）也同步地升高/降低。

## 支持Webtransport标准流播放

延时更低、可以秒开、弥补WebRTC不足。

## 支持播放器自定义水印

支持播放器播放过程中，显示水印，例如公司名称，公司logo等。

## 支持截图加自定义水印

支持调用截图接口的时候，添加自定义水印，例如公司名称，公司logo。

## 支持电子放大

## 支持HLS H264直播流

支持播放HLS H264直播流内容


## 支持UI控件流分辨率配置和展示，提供事件回调，方便在全屏模型下操作

## 支持SIMD软解码加速

(使用Chrome/Edge 91, Firefox89及之后正式提供的SIMD指令集加速解码, 在1080P以上分辨率带来100%-300%的性能提升)

## 支持直播流crypto解密播放

支持直播流crypto解密播放

## 支持定制化服务开发
支持一系类和业务耦合的开发需求。

## 支持作者

<img src="/public/wx.jpg"><img src="/public/alipay.jpg">

# 群
<img src="/public/qrcode.jpeg">
